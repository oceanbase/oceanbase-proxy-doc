# Overview

A diagnostic point describes the key procedure in the routing and forwarding process on OceanBase Database Proxy (ODP). You can view diagnostic points to learn about the routing and forwarding process. This topic describes how to troubleshoot issues based on diagnostic points.

## Troubleshooting procedure

After you obtain diagnostic information, you can perform different troubleshooting operations based on whether the routed request is in the transaction.

### Request in the transaction

If a request in a transaction is inaccurately routed, two cases are involved.

* Distributed transaction routing

   * If the current request is inaccurately routed, check the diagnostic points based on the diagnostic procedure.

   * If the current request is routed to the coordinator node, extract the SQL statement in [Trans First Query], pass the statement to the `explain route` command to run the command again, and check the diagnostic points based on the diagnostic procedure.

* Non-distributed transaction routing

   The current request is routed together with the first statement in the transaction. In this case, extract the SQL statement in [Trans First Query], pass the statement to the `explain route` command to run the command again, and check the diagnostic points based on the diagnostic procedure.

### Request not in the transaction

If an inaccurately routed request is not in a transaction, you can directly check the diagnostic points based on the diagnostic procedure.

## Diagnostic procedure

After you obtain diagnostic information by running the `explain route` command or from diagnostic logs, you can check each diagnostic point based on the following procedure. For more information about the variables to diagnose at each diagnostic point, see the following topics of diagnostic points.

The following table summarizes the diagnostic points based on the execution sequence. A higher diagnostic level indicates more detailed diagnostic information.

<main id="notice" type='explain'>
  <h4>Note</h4>
  <ul>
  <li>
  <p>Not all data of diagnostic points is recorded in logs or returned in the result set. Only data useful to the current situation is recorded or returned. </p>
  </li>
  <li>
  <p>The <code>TABLE_ENTRY_LOOKUP_START</code> and <code>PARTITION_ID_CALC_START</code> diagnostic points have no data and are used only to maintain the tree structure of diagnostic points.</p>
  </li>
  </ul>
</main>

<table>
  <thead>
    <tr>
      <th>Diagnostic phase</th>
      <th>Diagnostic point</th>
      <th>Diagnostic point level</th>
    </tr>
  </thead>
  <tr>
    <td>Syntax parsing</td>
    <td>SQL_PARSE</td>
    <td>1</td>
  </tr>
  <tr>
    <td>Routing information acquisition</td>
    <td>ROUTE_INFO</td>
    <td>1</td>
  </tr>
  <tr>
    <td rowspan="13">Replica location acquisition</td>
    <td>LOCATION_CACHE_LOOKUP</td>
    <td>1</td>
  </tr>
  <tr>
    <td>ROUTINE_ENTRY_LOOKUP_DONE</td>
    <td>2</td>
  </tr>
  <tr>
    <td>TABLE_ENTRY_LOOKUP_START</td>
    <td>2</td>
  </tr>
  <tr>
    <td>FETCH_TABLE_RELATED_DATA</td>
    <td>3</td>
  </tr>
  <tr>
    <td>TABLE_ENTRY_LOOKUP_DONE</td>
    <td>2</td>
  </tr>
  <tr>
    <td>PARTITION_ID_CALC_START</td>
    <td>2</td>
  </tr>
  <tr>
    <td>EXPR_PARSE</td>
    <td>3</td>
  </tr>
  <tr>
    <td>CALC_ROWID</td>
    <td>3</td>
  </tr>
  <tr>
    <td>RESOLVE_EXPR</td>
    <td>3</td>
  </tr>
  <tr>
    <td>RESOLVE_TOKEN</td>
    <td>4</td>
  </tr>
  <tr>
    <td>CALC_PARTITION_ID</td>
    <td>3</td>
  </tr>
  <tr>
    <td>PARTITION_ID_CALC_DONE</td>
    <td>2</td>
  </tr>
  <tr>
    <td>PARTITION_ENTRY_LOOKUP_DONE</td>
    <td>2</td>
  </tr>
  <tr>
    <td>Node selection based on the routing strategy</td>
    <td>ROUTE_POLICY</td>
    <td>1</td>
  </tr>
  <tr>
    <td>Replica access control</td>
    <td>CONGESTION_CONTROL</td>
    <td>1</td>
  </tr>
  <tr>
    <td>Response handling</td>
    <td>HANDLE_RESPONSE</td>
    <td>1</td>
  </tr>
  <tr>
    <td>Replication selection and retry</td>
    <td>RETRY</td>
    <td>1</td>
  </tr>
</table>

### Diagnostic skills

* Pay attention to the WARN information in Route Prompts and the diagnostic data near the corresponding diagnostic point.

* Pay attention to the error information in Route Plan.

* Set `route_diagnosis_level` to `4` and `monitor_log_level` to 'TRACE' and view the diagnostic results of all user requests in the diagnostic logs.

   For more information about `route_diagnosis_level`, see [route_diagnosis_level](../../../400.configuration-management/200.dynamically-effective/2036.route_diagnosis_level.md). For more information about `monitor_log_level`, see [monitor_log_level](../../../400.configuration-management/200.dynamically-effective/1520.monitor-log-level.md).
