# V3.1.1

## 版本信息

|  类目  |              描述              |
|------|------------------------------|
| 版本号  | obproxy-3.1.1-20210804145754 |
| 前置版本 | 无                            |
| 发布时间 | 2021-08-04                   |

## 功能优化

* 支持复制表随机路由。

* 支持弱读请求发往备副本。

## 修复的问题

* ODP V3.X 版本切换 Session 时可能出现无法同步线程变量的问题。

* 修复 Hint 包含特殊符号, 导致执行插入解析失败问题。

* 修复拉取不存在引起的连接关闭问题，报错信息为 `fetch not exist will close connection`。

* 修复从 V2.0.12 升级到 V2.0.20.1 后，事务未开始，回滚失败的问题。

## 升级注意事项

* 早于 V2.2.7X 的 OceanBase 数据库版本，需要先升级 OceanBase 数据库再升级 ODP，否则会因为开 PS，导致 Core 或者报 4201 错误。

* 高于 V2.2.7X 的 OceanBase 数据库版本，需升级到 V3.1.X 及更高版本，如果 ODP 版本早于 V1.8.2（此版本之后 ODP 开始才支持 OceanBase 数据库 V3.X.X 新的 Hash 和 Key 分区算法），则需要先升级 ODP 再升级 OceanBase 数据库，否则会因为 V3.1.X 的 Hash 算法变更，出现断连接等问题。
