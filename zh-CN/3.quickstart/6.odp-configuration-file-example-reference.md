ODP 配置文件示例参考 
=================================

使用 `config server` 启动 ODP 时，需要指定配置文件 `obproxy_config`。`obproxy_config` 为 JSON 格式的文件。本文提供 `obproxy_config` 示例文件和示例文件中的参数说明。

ODP 配置文件限制 
-------------------------------

ODP 的配制文件有以下限制：

* ODP 配置文件大小不得超过 16k。

  

* ODP 配置文件中的 `key_name` 字段大小写敏感。如果 `key_name` 字段匹配失败，则 ODP 启动失败。

  

* ODP 配置文件最多只能配置 16 个集群。如果配置集群超过 16 个，则 ODP 启动失败。如果在 ODP 运行过程中，您在更新配置文件时配置了超过 16 个集群，则 config server 不会更新配置，并将保留更新之前的集群信息。

  




ODP 配置文件 
-----------------------------

```json
{
 "Message":"successful",
 "Success":true,
 "Code":200,
 "Data": {
      "Version":"9254042f506530ffe6ce1f3ac718d817",
    "ObRootServiceInfoList": [ 
        {
          "ObRegion":"ob1",
          "ObRootServiceInfoUrl":"xxxxxxxxxxx"
        },
        {
          "ObRegion":"ob2",
          "ObRoorServiceInfoUrl":"yyyyyyyyyyyyyyy"
        }
      ],
  "ObProxyDatabaseInfo": {
   "MetaDataBase":"xxxxxxxxxx",
   "DataBase":"oceanbase",
   "User":"admin@sys",
   "Password":"admin"
  }
  "ObProxyBinUrl":"http://oceanbase.test.alibaba-inc.com/ocp-api/client?Action=GetObProxy&User_ID=alibaba-inc&UID=ocpmaster"
 }
}
```



参数说明 
-------------------------



|         参数名称         |                                                                                                                                                                                                                                                                                                  描述                                                                                                                                                                                                                                                                                                   |
|----------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ObRootServiceInfoUrl | 指定获取 OceanBase 数据库服务配置的 URL。此参数用于获取 root server 列表。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ObProxyDatabaseInfo  | 指定 `ob_all_proxy`、`ob_all_proxy_stat`、`ob_all_proxy_config`、`ob_all_proxy_kv_table`，以及`ob_all_proxy_vip_tenant_table` 的存储位置。 * 以上五张表均存储在同一台服务器上。表内包含 MetaDataBase（数据库所在的集群名称）, DataBase（数据库名），用户名（格式为username@tenantname），及密码。   * 建表过程参考 [创建表操作步骤](#section-18w-415-kwo)。                                                                                                                                                                                                         |
| ObProxyBinUrl        | 指定热升级时新 ODP RPM 安装包的下载路径。 * 热升级时，ODP 将使用本路径与 `new_binary_version`（从 `ob_all_proxy` 中读取）拼接出一个完整的路径，然后根据这个路径拉取最新的 RPM 安装包或二进制文件。   * 例如，如果解析的目录是 http://oceanbase.test.alibaba-inc.com/ocp-api/client?Action=GetObProxy\&User_ID=alibaba-inc\&UID=ocpmaster，`ob_all_proxy` 中`new_binary_version` 字段是 `obproxy-1.0.3-test.el6.x86_64`，则完整的下载路径为 http://oceanbase.test.alibaba-inc.com/ocp-api/client?Action=GetObProxy\&User_ID=alibaba-inc\&UID=ocpmaster\&Version=obproxy-1.0.3-test.el6.x86_64。    |



创建表操作步骤 
----------------------------

1. 创建连接池。

   根据 MetaDataBase 所在的集群拉取 rs 列表，创建连接池。
   

2. 获取租户 ID。

   通过解析租户名，获取租户 ID。
   

3. 选择服务器。

   从 `__all_root_table` 中选出该租户所在的一台服务器。
   



