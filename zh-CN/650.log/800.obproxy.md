# obproxy.log

obproxy.log 日志是记录 ODP 详细信息的日志，内容最全面。

## 日志格式

obproxy.log 日志的通用格式如下所示：

```shell
[time] log_level [module] file_name:line_number [thread_id][trace_id] [log_used_time] [dropped_msg_count] info
```

如格式中所示，一条日志通常由头部（header）和消息体（message）组成：

* header 部分：
  
  * `time`：该条日志打印的时间。

  * `log_level`：该条日志的级别，目前支持以下级别（由低到高）：DEBUG、TRACE、WDIAG、EDIAG、INFO、WARN、ERROR。

  * `module`：当前打印日志的模块名。

  * `file_name:line_number`：当前打印日志的代码源文件名以及行号。

  * `thread_id`：当前打印日志的线程 ID。

  * `trace_id`：用于跟踪一个任务的 trace_id，任务级唯一，可以根据 trace_id 来获取一个任务的所有日志数据。

  * `log_used_time`：指上一条日志的处理时间 (异步日志场景包含日志写入文件时间)。

  * `dropped_msg_count`：dc=xx，其中 xx 表示当前日志距离上一条日志期间丢弃的日志个数, 没有丢弃时为 0。

* message 部分：消息体一般描述具体的日志内容。

## 示例

本文通过示例介绍 obproxy.log 日志的通用格式，示例如下：

```bash
[2024-01-03 17:31:15.864604] INFO  [PROXY.SM] ob_mysql_sm.cpp:9317 [1782][Y0-00007F986AC85710] [lt=0] [dc=0] setup_error_transfer, transfer internal buffer and try to disconnect(sql_cmd=242, internal_state=14)
```

对日志进行拆解，得到日志格式：

* time：`2024-01-03 17:31:15.864604`

* log_level：`INFO`

* module：`PROXY.SM`

* file_name:line_number：`ob_mysql_sm.cpp:9317`

* thread_id：`1782`

* trace_id：`Y0-00007F986AC85710`

* log_used_time：`lt=0`

* dropped_msg_count：`dc=0`

* info：`setup_error_transfer, transfer internal buffer and try to disconnect(sql_cmd=242, internal_state=14)`
