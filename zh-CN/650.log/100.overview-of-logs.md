# 日志概述

本文主要介绍 ODP 中存在哪些日志文件，ODP 日志的级别，以及 ODP 中和日志相关的配置项。

## 日志文件

ODP 的日志存放在 ODP 安装目录的 log 目录下，您需关注的日志如下表所示：

|       文件名称         |                文件介绍                                |
|-----------------------|--------------------------------------------------------|
| obproxy_diagnosis.log | 记录 ODP 登录、启动、断连接、路由错误等信息的诊断日志。     |
| obproxy_digest.log    | 记录执行时间超过 `query_digest_time_threshold` 配置项的 SQL 和执行失败的 SQL 相关信息。                      |
| obproxy_error.log     | 记录执行失败的 SQL 相关信息。                             |
| obproxy_slow.log      | 记录慢 SQL 请求信息的日志。                               |
| obproxy_stat.log      | 统计日志，记录一段时间内的 SQL 执行情况。                  |
| obproxy_trace.log     | 记录全链路诊断信息的日志。                                |
| obproxy.log           | 记录 ODP 详细信息的日志，内容最全面。                      |

## 日志级别

ODP 日志划分了七个日志级别，含义如下表所示。

<main id="notice" type='explain'>
  <h4>说明</h4>
  <p>表中的日志级别从高到低依次排列。</p>
</main>

| 日志级别  |                                                含义                                        |
|----------|--------------------------------------------------------------------------------------------|
| ERROR    | ODP 出现严重错误。用于记录 ODP 的故障信息，且必须进行故障排除，否则系统不可用。                           |
| WARN     | 出现非预期场景。ODP 能继续提供服务，但行为可能不符合预期，或可能将有严重错误发生，需进行故障排除。           |
| INFO     | 系统状态变化信息。用于记录系统运行的当前状态，该信息为正常信息。                                            |
| EDIAG    | Error Diagnosis，协助故障排查的诊断信息，非预期的逻辑错误。                    |
| WDIAG    | Warning Diagnosis，协助故障排查的诊断信息，预期内的错误。            |
| TRACE    | 任务级调试信息。                                    |
| DEBUG    | 详细调试信息。    |

您可通过 `show proxyconfig` 命令查看系统日志（`syslog_level`）或监控日志打印（`monitor_log_level`）级别，系统日志默认打印级别为 `WDIAG` 级别，监控日志默认打印级别为 `INFO` 级别。

```shell
obclient > show proxyconfig like '%log_level%';
```

返回结果如下：

```shell
+-------------------+-------+-------------------------------------------------------------------------------------------------+-------------+---------------+
| name              | value | info                                                                                            | need_reboot | visible_level |
+-------------------+-------+-------------------------------------------------------------------------------------------------+-------------+---------------+
| xflush_log_level  | ERROR | specifies the current level of logging: DEBUG, TRACE, INFO, WDIAG, EDIAG, WARN, ERROR | false       | USER          |
| monitor_log_level | INFO  | specifies the current level of logging: DEBUG, TRACE, WDIAG, EDIAG, INFO, WARN, ERROR | false       | USER          |
| syslog_level      | WDIAG | specifies the current level of logging: DEBUG, TRACE, WDIAG, EDIAG, INFO, WARN, ERROR | false       | USER          |
+-------------------+-------+-------------------------------------------------------------------------------------------------+-------------+---------------+
```

## 相关配置项

ODP 中与日志相关的配置项如下表所示。

| 配置项  |  功能描述    |
|---------|--------------|
| [log_file_percentage](../400.configuration-management/200.dynamically-effective/1360.log-file-percentage.md) | 用于设置 ODP 日志文件占用可用空间的百分比阈值。 |
| [log_dir_size_threshold](../400.configuration-management/200.dynamically-effective/1350.log-dir-size-threshold.md) | 用于设置 ODP 日志所在目录的最大可用空间阈值。 |
| [syslog_io_bandwidth_limit](../400.configuration-management/200.dynamically-effective/2478.syslog-io-bandwidth-limit.md) | 用于设置 ODP 日志所能占用的磁盘 IO 带宽上限。 |
| [enable_syslog_wf](../400.configuration-management/200.dynamically-effective/902.enable-syslog-wf.md) | 用于设置是否将 WARN 以上级别的 obproxy.log 日志打印到一个单独的日志文件（obproxy.log.wf）中。 |
| [max_log_file_size](../400.configuration-management/200.dynamically-effective/1390.max-log-file-size.md) | 用于设置 ODP 中单个日志文件的最大限制。 |
| [log_cleanup_interval](../400.configuration-management/200.dynamically-effective/1340.log-cleanup-interval.md) | 用于设置日志文件清理任务的间隔时间。 |
| [max_syslog_file_time](../400.configuration-management/200.dynamically-effective/1420.max-syslog-file-time.md) | 用于设置存档日志的最大保留时间。 |
| [max_syslog_file_count](../400.configuration-management/200.dynamically-effective/1410.max-syslog-file-count.md) | 用于设置存档日志可保留的最大数量。 |
| [enable_syslog_file_compress](../400.configuration-management/200.dynamically-effective/900.enable-syslog-file-compress.md) | 用于控制是否开启归档日志压缩。 |
| [syslog_level](../400.configuration-management/200.dynamically-effective/2480.syslog-level.md) | 用于设置系统日志（obproxy.log）打印级别。 |
| [monitor_log_level](../400.configuration-management/200.dynamically-effective/1520.monitor-log-level.md) |用于设置监控日志打印级别。  |
| [enable_async_log](../400.configuration-management/200.dynamically-effective/380.enable-async-log.md) | 用于判断是否开启异步日志。 |

您可执行如下命令修改配置项，详细介绍可参见 [配置项说明](../400.configuration-management/100.get-and-modify-configuration.md)。

```shell
ALTER proxyconfig SET <var_name> = <var_value>
```
